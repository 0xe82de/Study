# Contents

- [1.8.1 XML 설정](#181-XML-설정)
- [1.8.2 XML을 이용하는 애플리케이션 컨텍스트](#182-XML을-이용하는-애플리케이션-컨텍스트)
- [1.8.3 DataSource 인터페이스로 변환](#183-DataSource-인터페이스로-변환)
- [1.8.4 프로퍼티 값의 주입](#184-프로퍼티-값의-주입)

# 1.8 을 이용한 설정

본격적인 `DI 컨테이너`를 사용하면서 오브젝트 사이의 의존정보를 일일이 자바 코드로 만들어주려면 번거롭다. 스프링은 `DaoFactory`와 같은 자바 클래스를 이용하는 것 외에도, 다양한 방법을 통해 `DI` 의존관계 설정정보를 만들 수 있다. 대표적인 것이 바로 `XML`이다.

`XML`의 장점은 다음과 같다.

- 단순한 텍스트 파일이기 때문에 다루기 쉽다.
- 쉽게 이해할 수 있으며, 컴파일과 같은 별도의 빌드 작업이 없다.
- 환경이 달라져서 오브젝트의 관계가 바뀌는 경우에도 빠르게 변경사항을 반영할 수 있다.
- `스키마`나 `DTD`를 이용해서 정해진 포맷을 따라 작성됐는지 쉽게 확인할 수 있다.

## 1.8.1 XML 설정

스프링의 `애플리케이션 컨텍스트`는 `XML`에 담긴 `DI` 정보를 활용할 수 있다. `DI` 정보가 담긴 `XML` 파일은 `<beans>`를 루트 엘리먼트로 사용한다. `<beans>` 안에는 여러 개의 `<bean>`을 정의할 수 있다.

`XML` 설정은 `Configuration`과 `@Bean`이 붙은 자바 클래스로 만든 설정과 내용이 동일하다. 하나의 `@Bean` 메서드에서 얻을 수 있는 정보는 다음과 같다.

| 정보               | 설명                                                                                                                                                                                                                               |
| ------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 빈의 이름          | `@Bean` 메서드 이름이 `빈`의 이름이다. 이 이름은 `getBean()` 메서드에서 사용된다.                                                                                                                                                  |
| 빈의 클래스        | `빈` 오브젝트를 어떤 클래스를 이용해서 만들지를 정의한다.                                                                                                                                                                          |
| 빈의 의존 오브젝트 | `빈`의 생성자나 수정자 메서드를 통해 `의존 오브젝트`를 넣어준다. `의존 오브젝트`도 하나의 `빈`이므로 이름이 있을 것이고, 그 이름에 해당하는 메서드를 호출해서 `의존 오브젝트`를 가져온다. `의존 오브젝트`는 하나 이상일 수도 있다. |

`XML`에서 `<bean>`을 사용해도 위 세 가지 정보를 정의할 수 있다. `ConnectionMaker`처럼 더 이상 의존하고 있는 오브젝트가 없을 때는 세 번째 `의존 오브젝트` 정보는 생략할 수 있다.

### connectionMaker() 전환

`DaoFactory`의 `connectionMaker()` 메서드에 해당하는 `빈`을 `XML`로 정의해보자.

`connectionMaker()`로 정의되는 `빈`은 의존하는 다른 오브젝트는 없으니 `DI` 정보 세 가지 중 두 가지만 있으면 된다. 아래의 표는 자바 코드로 만든 설정정보와 그에 대응되는 `XML`의 설정정보를 비교한 것이다.

| 구분        | 자바 코드 설정정보      | XML 설정정보                 |
| ----------- | ----------------------- | ---------------------------- |
| 빈 설정파일 | @Configuration          | \<beans\>                    |
| 빈의 이름   | @Bean methodName()      | \<bean id="methodName"       |
| 빈의 클래스 | return new BeanClass(); | class="a.b.c... BeanClass"\> |

`DaoFactory`의 `@Bean` 메서드에 담긴 정보를 1:1로 `XML`의 태그와 애트리뷰트로 전환해주면 된다. 단, `<bean>` 태그의 `class` 애트리뷰트에 지정하는 것은 자바 메서드에서 오브젝트를 만들 때 사용하는 클래스 이름이라는 점에 주의해야 한다. 그리고 `class` 애트리뷰트에 넣을 클래스 이름은 패키지까지 모두 포함해야 한다.

```java
@Bean // -> <bean
public ConnectionMaker
connectionMaker() { // -> id="connectionMaker"
    return new DConnectionMaker(); // -> class="springbook.user.dao.DConnectionMaker" />
}
```

### userDao() 전환

`userDao()`에는 `DI` 정보의 세 가지 요소가 모두 들어 있다. 여기서 관심을 가질 것은 수정자 메서드로 의존관계를 주입해주는 부분이다. 스프링 개발자가 수정자 메서드를 선호하는 이유 중에는 `XMl`로 의존관계 정보를 만들 때 편리하다는 점도 있다.

`자바빈`의 관례를 따라서 수정자 메서드는 프로퍼티가 된다. 프로퍼티 이름은 메서드 이름에서 `set`을 제외한 나머지 부분을 사용한다. 예를 들어 오브젝트에 `setConnectionMaker()` 메서드가 있다면 `connectionMaker`라는 프로퍼티를 갖는다고 할 수 있다.

`XML`에서는 `<property>` 태그를 사용해 `의존 오브젝트`와의 관계를 정의한다. `<property>`는 `name`과 `ref`라는 두 개의 애트리뷰트를 갖는다.

| 태그 | 설명                                                                                     |
| ---- | ---------------------------------------------------------------------------------------- |
| name | 프로퍼티의 이름. 프로퍼티 이름으로 수정자 메서드를 알 수 있다.                           |
| ref  | 수정자 메서드를 통해 주입해줄 오브젝트의 `빈` 이름이다. `DI`할 오브젝트도 역시 `빈`이다. |

```java
userDao.setConnectionMaker(connectionMaker());
```

위의 코드는 두 가지 의미를 가지는데, 다음과 같다.

1. `userDao 빈`의 `connectionMaker` 프로퍼티를 이용해 의존관계 정보를 주입한다는 뜻이다.
2. 메서드의 파라미터로 넣는 `connectionMaker()`는 `connectionMaker()` 메서드를 호출해서 리턴하는 오브젝트를 주입하라는 뜻이다.

이 두 가지 정보를 `<property>`의 `name` 애트리뷰트와 `ref` 애트리뷰트로 지정해주면 된다. 각 정보를 다음과 같이 `<property>` 태그에 대응할 수 있다.

```java
userdao
.setConnectionMaker( // -> <property name="connectionMaker"
    connectionMaker() // -> ref="connectionMaker" />
);
```

위 `<property>` 태그를 `userDao 빈`을 정의한 `<bean>` 태그 안에 넣어주면 다음과 같다.

```xml
<bean id="userDao" class="springbook.user.dao.UserDao">
    <property name="connectionMaker" ref="connectionMaker" />
</bean>
```

### XML의 의존관계 주입 정보

`connectionMaker()`, `userDao()` 두 개를 `<bean>` 태그로 전환하고 합치면 아래와 같다.

```xml
<beans>
    <bean id="connectionMaker" class="springbook.user.dao.DConnectionMaker" />
    <bean id="userDao" class="springbook.user.dao.UserDao">
        <property name="connectionMaker" ref="connectionMaker" />
    </bean>
</beans>
```

때로는 같은 인터페이스를 구현한 `의존 오브젝트`를 여러 개 정의해두고 그 중에서 원하는 것을 골라서 `DI` 하는 경우도 있다. 이 때는 각 `빈`의 이름을 독립적으로 만들어두고 `ref` 애트리뷰트를 이용해 `DI` 받을 `빈`을 지정해주면 된다.

아래의 `XML` 설정은 `LocalDB`, `TestDB`, `ProductionDB`를 사용하는 `ConnectionMaker` 인터페이스의 구현 클래스를 각각 정의해두고 `DAO`에서 하나를 선택해서 사용할 수 있도록 구성한 것이다.

```xml
<beans>
    <bean id="localDBConnectionMaker" class="...LocalDBConnectionMaker" />
    <bean id="testDBConnectionMaker" class="...TestDBConnectionMaker" />
    <bean id="productionDBConnectionMaker" class="...ProductionDBConnectionMaker" />

    <bean id="userDao" class="springbook.user.dao.UserDao">
        <property name="connectionMaker" ref="localDBConnectionMaker" />
    </bean>
</beans>
```

## 1.8.2 XML을 이용하는 애플리케이션 컨텍스트

## 1.8.3 DataSource 인터페이스로 변환

### DataSource 인터페이스 적용

### 자바 코드 설정 방식

### 프로퍼티 값의 주입

## 1.8.4 프로퍼티 값의 주입
