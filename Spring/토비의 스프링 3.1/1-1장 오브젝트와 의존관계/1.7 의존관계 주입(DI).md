# Contents

- [1.7.1 제어의 역전(IoC)과 의존관계 주입](#171-제어의-역전IoC과-의존관계-주입)
- [1.7.2 런타임 의존관계 설정](#172-런타임-의존관계-설정)
- [1.7.3 의존관계 검색과 주입](#173-의존관계-검색과-주입)
- [1.7.4 의존관계 주입의 응용](#174-의존관계-주입의-응용)
- [1.7.5 메소드를 이용한 의존관계 주입](#175-메소드를-이용한-의존관계-주입)

# 1.7 의존관계 주입(DI)

## 1.7.1 제어의 역전(IoC)과 의존관계 주입

`IoC`라는 용어가 매우 폭넓게 사용되므로, 스프링이 제공하는 `IoC` 방식을 핵심을 짚어주는 `의존관계 주입(Dependency Injection)`이라는 의도가 명확히 드러나는 이름을 사용하기 시작했다.

## 1.7.2 런타임 의존관계 설정

### 의존관계

두 개의 클래스 또는 모듈이 의존관계에 있다고 말할 때는 항상 방향성을 부여해줘야 한다. `UML` 모델에서는 두 클래스의 의존관계를 점선으로 된 화살표로 나타낸다. 예를 들어, A 클래스에서 B 클래스 방향으로 점선으로 된 화살표가 있다면, A 클래스는 B 클래스에 의존하고 있음을 나타낸다.

의존한다는 것의 의미는 B 클래스가 변하면 A 클래스에게 영향을 미친다는 뜻이다. 반면에, A 클래스가 변해도 B 클래스에게는 영향을 미치지 않는다.

### UserDao의 의존관계

지금까지 작업한 `UserDao`는 `ConnectionMaker` 인터페이스에만 의존하고 있다. 즉, `ConnectionMaker` 인터페이스가 변하면 그 영향을 `UserDao`가 직접적으로 받는다. 그에 반해, `ConnectionMaker`의 구현 클래스 `DConnectionMaker`가 다른 것으로 바뀌거나 내부 메서드에 변화가 생겨도 `UserDao`에 영향을 주지 않는다.

이렇게 인터페이스에 대해서만 의존관계를 만들어두면 인터페이스의 구현 클래스와의 관계는 느슨해지면서 변화에 영향을 덜 받는 상태가 되고, 결합도가 낮다고 말할 수 있다. `UML`에서 말하는 의존관계란 이렇게 설계 모델의 관점에서 말하는 것이다.

그런데, 모델이나 코드에서 클래스와 인터페이스를 통해 드러나는 의존관계 말고, 런타임 시에 오브젝트 사이에서 만들어지는 의존관계도 있다. 인터페이스를 통해 설계 시점에 느슨한 의존관계를 갖는 경우에도 `UserDao`의 오브젝트가 런타임 시에 사용할 오브젝트가 어떤 구현 클래스로 만든 것인지 미리 알 수가 없다. `UserDao`나 `ConnectionMaker` 등의 설계와 코드 속에서 드러나지 않는다는 말이다. 프로그램이 실행되고 `UserDao` 오브젝트가 만들어지고 나서 런타임 시에 의존관계를 맺는 대상, 즉 실제 사용대상인 오브젝트를 `의존 오브젝트(dependent object)`라고 말한다.

`의존관계 주입`은 구체적인 `의존 오브젝트`와 그것을 사용할 주체, 일반적으로 `클라이언트`라고 부르는 오브젝트를 런타임 시에 연결해주는 작업을 말한다. 정리하면 다음의 세 가지 조건을 만족하는 작업을 `의존관계 주입`이라 한다.

- 클래스 모델이나 코드에는 런타임 시점의 의존관계가 드러나지 않는다. 그러기 위해서는 인터페이스에만 의존하고 있어야 한다.
- 런타임 시점의 의존관계는 컨테이너나 팩토리 같은 제삼자가 결정한다.
- 의존관계는 사용할 오브젝트에 대한 레퍼런스를 외부에서 주입해줌으로써 만들어진다.

`의존관계 주입`의 핵심은 설계 시점에 알지 못했던 두 오브젝트의 관계를 맺도록 도와주는 제삼자가 있다는 것이다. 앞서 만들었던 `DaoFactory`, 스프링의 `ApplicationContext`, `빈 팩토리`, `IoC 컨테이너` 등이 모두 외부에서 오브젝트 사이의 런타임 관계를 맺어주는 책임을 지닌 제삼자라고 볼 수 있다.

### UserDao의 의존관계 주입

`DaoFactory`는 `UserDao`, `ConnectionMaker` 두 오브젝트 사이의 런타임 의존관계를 설정해주는 `의존관계 주입` 작업을 주도하는 존대이며, 동시에 `IoC` 방식으로오브젝트의 생성과 초기화, 제공 등의 작업을 수행하는 컨테이너다. 따라서 `의존관계 주입`을 담당하는 컨테이너라고 볼 수 있으므로, `DI 컨테이너`라고 불러도 된다.

`DI 컨테이너`인 `DaoFactory`는 자신이 결정한 의존관계를 맺어줄 클래스의 오브젝트를 만들고 이 생성자의 파라미터로 오브젝트의 레퍼런스를 전달해준다. 이렇게 두 개의 오브젝트 간의 런타임 의존관계가 만들어졌고, `UserDao` 오브젝트는 생성자를 통해 주입받은 `DConnectionMaker` 오브젝트를 언제든지 사용하면 되는 것이다.

## 1.7.3 의존관계 검색과 주입

## 1.7.4 의존관계 주입의 응용

### 기능 구현의 교환

### 부가기능 추가

## 1.7.5 메소드를 이용한 의존관계 주입
