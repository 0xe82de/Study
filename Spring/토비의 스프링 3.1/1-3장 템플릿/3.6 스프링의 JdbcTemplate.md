# Contents

- [3.6.1 update()](#361-update)
- [3.6.2 queryForInt()](#362-queryForInt)
- [3.6.3 queryForObject()](#363-queryForObject)
- [3.6.4 query()](#364-query)
- [3.6.5 재사용 가능한 콜백의 분리](#365-재사용-가능한-콜백의-분리)

# 3.6 스프링의 JdbcTemplate

스프링은 `JDBC`를 이용하는 `DAO`에서 사용할 수 있도록 준비된 다양한 템플릿과 콜백을 제공한다. 스프링이 제공하는 `JDBC` 코드용 기본 템플릿은 `JdbcTemplate`이다.

앞에서 작성한 `JdbcContext`와 유사하지만 훨씬 강력하고 편리한 기능을 제공해준다. `JdbcContext`로 작성한 코드를 `JdbcTemplate`으로 수정하자.

```java
public class UserDao {
    private DataSource dataSource;
    private JdbcTemplate jdbcTemplate;

    public void setDataSource(DataSource dataSource) {
        this.jdbcTemplate = new JdbcTemplate(dataSource);
        this.dataSource = dataSource;
    }
    // ...
}
```

위와 같이 `JdbcTemplate`의 생성자 파라미터로 `DataSource` 오브젝트를 주입해주면 된다.

## 3.6.1 update()

`deleteAll`() 메서드도 바꿔보자. `deleteAll()` 메서드에 처음 적용했던 콜백은 `StatementStrategy` 인터페이스의 `makePreparedStatement()` 메서드다. 이에 대응되는 `JdbcTemplate`의 콜백은 `PreparedStatementCreator` 인터페이스의 `createPreapredStatement()` 메서드다.

```java
public class UserDao {
    // ...
    public void deleteAll() throws SQLException {
        this.jdbcTemplate.update(
                new PreparedStatementCreator() {
                    @Override
                    public PreparedStatement createPreparedStatement(Connection connection) throws SQLException {
                        return connection.prepareStatement("delete from users");
                    }
                }
        );
    }
    // ...
}
```

위와 같이 `JdbcTemplate`을 이용하여 코드를 수정하였다. 앞서 작성했던 `executeSql()` 메서드는 `SQL` 문장만 전달하면 미리 준비된 콜백은 만들어서 템플릿을 호출하는 것까지 한 번에 해줬었다. `JdbcTemplate`에도 비슷한 메서드가 존재한다. `update()` 메서드와 이름은 동일한테 파라미터로 `SQL` 문장을 전달한다는 것만 다르다. 아래와 같이 간결하게 수정할 수 있다.

```java
public class UserDao {
    // ...
    public void deleteAll() throws SQLException {
        this.jdbcTemplate.update("delete from users");
    }
    // ...
}
```

이제 `add()` 메서드도 수정해보자. `add()` 메서드는 추가적으로 파라미터를 바인딩해야 하는데, 이를 지원하는 기능을 가진 `update()` 메서드를 사용하면 된다.

```java
public class UserDao {
    // ...
    public void add(final User user) throws SQLException {
        this.jdbcTemplate.update(
                "insert into users (id, name, password) values (?, ?, ?)",
                user.getId(),
                user.getName(),
                user.getPassword()
        );
    }
    // ...
}
```

위와 같이 파라미터를 순서대로 전달해주면 된다.

## 3.6.2 queryForInt()

## 3.6.3 queryForObject()

## 3.6.4 query()

### 기능 정의와 테스트 작성

### query() 템플릿을 이용하는 getAll() 구현

### 테스트 보완

## 3.6.5 재사용 가능한 콜백의 분리

### DI를 위한 코드 정리

### 중복 제거

### 템플릿/볼백 패턴과 UserDao
